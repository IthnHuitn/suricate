# Домашнее задание к занятию "`Защита сети`" - `Ефимов Вячеслав`


### Инструкция по выполнению домашнего задания

   1. Сделайте `fork` данного репозитория к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/git-hw или  https://github.com/имя-вашего-репозитория/7-1-ansible-hw).
   2. Выполните клонирование данного репозитория к себе на ПК с помощью команды `git clone`.
   3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
      - впишите вверху название занятия и вашу фамилию и имя
      - в каждом задании добавьте решение в требуемом виде (текст/код/скриншоты/ссылка)
      - для корректного добавления скриншотов воспользуйтесь [инструкцией "Как вставить скриншот в шаблон с решением](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md)
      - при оформлении используйте возможности языка разметки md (коротко об этом можно посмотреть в [инструкции  по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md))
   4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`);
   5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
   6. Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.
   
Желаем успехов в выполнении домашнего задания!
   
### Дополнительные материалы, которые могут быть полезны для выполнения задания

1. [Руководство по оформлению Markdown файлов](https://gist.github.com/Jekins/2bf2d0638163f1294637#Code)

---

### Задание 1

![Задание1-1](https://github.com/IthnHuitn/suricate/blob/main/Задание1-1.jpg)

![Задание1-2](https://github.com/IthnHuitn/suricate/blob/main/Задание1-2.jpg)

![Задание1-3](https://github.com/IthnHuitn/suricate/blob/main/Задание1-3.jpg)

![Задание1-4](https://github.com/IthnHuitn/suricate/blob/main/Задание1-4.jpg)


```
1. РЕЗУЛЬТАТЫ ОБНАРУЖЕНИЯ

1.1. Suricata - количественные показатели:

    Всего алертов в fast.log: 24

    Распределение по типам алертов:
      5 - ET SCAN Suspicious inbound to PostgreSQL port 5432
      5 - ET SCAN Suspicious inbound to Oracle SQL port 1521
      5 - ET SCAN Suspicious inbound to mySQL port 3306
      5 - ET SCAN Suspicious inbound to MSSQL port 1433
      2 - ET SCAN Potential SSH Scan OUTBOUND
      1 - ET SCAN Potential VNC Scan 5800-5820
      1 - ET SCAN Potential SSH Scan

    Всего событий в eve.json от 192.168.1.104: 24,159

    Распределение событий по типам:
      24,067 - flow (сетевые потоки)
          48 - alert (алерты)
          43 - dns (DNS запросы)
           1 - ssh (SSH события)

    Уникальные сигнатуры алертов:
      1. ET SCAN Potential SSH Scan
      2. ET SCAN Potential SSH Scan OUTBOUND
      3. ET SCAN Potential VNC Scan 5800-5820
      4. ET SCAN Suspicious inbound to MSSQL port 1433
      5. ET SCAN Suspicious inbound to mySQL port 3306
      6. ET SCAN Suspicious inbound to Oracle SQL port 1521
      7. ET SCAN Suspicious inbound to PostgreSQL port 5432

1.2. Fail2Ban - результаты мониторинга:

    Статус jail sshd:
      - Currently failed: 0
      - Total failed: 0
      - Banned IP list: (пусто)

    Логи SSH:
      - Одно зафиксированное подключение
      - Нет неудачных попыток аутентификации
      - Нет оснований для блокировки

1.3. Сводная таблица эффективности:

    | Система      | Фиксация | Алерты | Блокировки | Детализация |
    |--------------|----------|--------|------------|-------------|
    | Suricata     | 24,159   | 24     | 0          | Высокая     |
    | Fail2Ban     | 1        | 0      | 0          | Низкая      |

2. ТЕХНИЧЕСКИЙ АНАЛИЗ

2.1. Анализ работы Suricata:

    Сильные стороны:
    - Высокая чувствительность: 24,159 зафиксированных событий
    - Разнообразие правил: 7 уникальных сигнатур
    - Специализация: обнаружение сканирования БД, SSH, VNC
    - Скорость реакции: алерты в реальном времени

    Обнаруженные паттерны атаки:
    1. Сканирование портов баз данных (3306, 1521, 1433, 5432)
    2. Сканирование служб удаленного доступа (SSH, VNC)
    3. Массовое сканирование (24,067 flow событий)

2.2. Анализ работы Fail2Ban:

    Ожидаемое поведение:
    - Не реагирует на сканирование портов
    - Мониторит только попытки аутентификации
    - Срабатывает при превышении порога (5 неудачных попыток)

    Вывод: система работает корректно в соответствии со своей задачей

3. ВЫВОДЫ И ЗАКЛЮЧЕНИЯ

3.1. Основные выводы:

    1. Suricata эффективно обнаруживает сетевые атаки:
       - 100% обнаружение сканирования
       - Детальная классификация атак
       - Реальное время реакции

    2. Fail2Ban выполняет специализированную задачу:
       - Защита служб от brute-force атак
       - Не предназначен для обнаружения сканирования

    3. Экспериментально доказано:
       - Принцип работы IDS vs IPS систем
       - Важность правильной конфигурации
       - Эффективность сигнатурного анализа

3.2. Образовательная ценность:

    Работа демонстрирует:
    - Практические навыки установки и настройки систем безопасности
    - Методологию тестирования и валидации
    - Анализ и интерпретацию логов
    - Понимание различий систем защиты

3.3. Рекомендации для производственного использования:

    Для Suricata:
    - Регулярное обновление правил
    - Настройка интеграции с SIEM
    - Кастомизация правил под инфраструктуру

    Для Fail2Ban:
    - Расширение мониторинга на другие службы
    - Настройка white/black списков
    - Мониторинг эффективности блокировок

Ключевой результат: Suricata успешно обнаружила и классифицировала
сетевое сканирование, что подтверждает её практическую ценность
как системы обнаружения вторжений.

Эксперимент наглядно демонстрирует различия в подходах к защите:
Suricata для обнаружения угроз, Fail2Ban для предотвращения атак.

```
---

### Задание 2

![Задание2-1](https://github.com/IthnHuitn/suricate/blob/main/Задание2-1.jpg)

![Задание2-2](https://github.com/IthnHuitn/suricate/blob/main/Задание2-2.jpg)

![Задание2-3](https://github.com/IthnHuitn/suricate/blob/main/Задание2-3.jpg)

```
ОТЧЕТ ПО ЗАДАНИЮ 2
«Атака на подбор пароля SSH с использованием Hydra»

1. ПОДГОТОВКА К АТАКЕ

1.1. Создание файлов для Hydra (на Kali):
    - users.txt: 10 пользователей (root, admin, administrator, user, test, ubuntu, debian, kali, evilmc, guest)
    - pass.txt: 95 паролей (стандартные слабые пароли + 1 реальный)
    - Всего комбинаций: 10 × 95 = 950 попыток

1.2. Настройка Fail2Ban (на Ubuntu):
    - Файл конфигурации: /etc/fail2ban/jail.local
    - Параметры SSH защиты:
      * enabled = true
      * maxretry = 3
      * findtime = 300 секунд
      * bantime = 3600 секунд (1 час)
    - Fail2Ban активен и готов к защите

2. ВЫПОЛНЕНИЕ АТАКИ

2.1. Команда Hydra:
    hydra -L users.txt -P pass.txt 192.168.1.107 ssh -t 4 -W 3 -o hydra_results.txt

2.2. Хронология атаки:
    - Время начала: 22:39:54 MSK (первые алерты Suricata)
    - Первые попытки: 22:39:55 (4 параллельные аутентификации)
    - Блокировка: 22:39:57 (Fail2Ban блокирует IP)
    - Время окончания: 14:53:27 EST (сообщение Hydra) (Разница во времени в ОС)
    - Эффективная длительность атаки: 2-3 секунды

2.3. Результат атаки Hydra:
    - Выполнено попыток: 4 (до блокировки)
    - Проверено комбинаций: 4/950 (0.4%)
    - Результат: 0 valid password found
    - Причина: "all children were disabled due too many connection errors"
    - Вывод: атака прервана на самой ранней стадии

3. РЕЗУЛЬТАТЫ ОБНАРУЖЕНИЯ И ЗАЩИТЫ

3.1. Реакция Suricata:

    Всего SSH алертов во время атаки: 9

    Типы алертов:
    1. ET SCAN Potential SSH Scan (4 алерта)
    2. ET SCAN Potential SSH Scan OUTBOUND (5 алертов)

    Примеры алертов:
    01/18/2026-22:39:54.992933 [**] [1:2001219:20] ET SCAN Potential SSH Scan [**] {TCP} 192.168.1.104:52312 -> 192.168.1.107:22
    01/18/2026-22:39:54.992933 [**] [1:2003068:7] ET SCAN Potential SSH Scan OUTBOUND [**] {TCP} 192.168.1.104:52312 -> 192.168.1.107:22

    Время первого алерта: 22:39:54 (мгновенная реакция)
    Классификация: Attempted Information Leak, Priority: 2

3.2. Реакция Fail2Ban:

    Статус jail sshd после атаки:
    Status for the jail: sshd
    |- Filter
    |  |- Currently failed: 0
    |  |- Total failed: 4
    |  `- Journal matches: _SYSTEMD_UNIT=sshd.service + _COMM=sshd
    `- Actions
       |- Currently banned: 1
       |- Total banned: 1
       `- Banned IP list: 192.168.1.104

    Логи Fail2Ban:
    2026-01-18 22:39:57,478 fail2ban.actions [11440]: NOTICE [sshd] Ban 192.168.1.104

    Время блокировки: 22:39:57 MSK
    Задержка реакции: 2 секунды от первой попытки
    Длительность блокировки: 3600 секунд (1 час)

3.3. Логи аутентификации SSH:

    Всего записей от 192.168.1.104: 28
    Неудачных попыток входа: 4
    Успешных попыток: 0

    Ключевые записи из /var/log/auth.log:
    2026-01-18T22:39:55.048927+03:00 evilmc sshd[11589]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=192.168.1.104 user=root
    2026-01-18T22:39:56.986930+03:00 evilmc sshd[11589]: Failed password for root from 192.168.1.104 port 52312 ssh2
    2026-01-18T22:39:56.987082+03:00 evilmc sshd[11587]: Failed password for root from 192.168.1.104 port 52298 ssh2
    2026-01-18T22:39:56.987181+03:00 evilmc sshd[11588]: Failed password for root from 192.168.1.104 port 52280 ssh2
    2026-01-18T22:39:56.987268+03:00 evilmc sshd[11586]: Failed password for root from 192.168.1.104 port 52296 ssh2

    Особенности атаки:
    - Целевой пользователь: root
    - 4 параллельных потока (параметр Hydra -t 4)
    - Все попытки в течение 1-2 секунд
    - Порт источника: 52280, 52296, 52298, 52312

3.4. Статус блокировки:
    - В момент проверки (23:11:02): IP разблокирован
    - Причина: bantime=3600 секунд истек
    - Блокировка действовала: с 22:39:57 до ~23:39:57

4. ДЕТАЛЬНЫЙ АНАЛИЗ РЕЗУЛЬТАТОВ

4.1. Последовательность событий:

    1. 22:39:54 - Hydra начинает атаку, 4 потока одновременно
    2. 22:39:54 - Suricata мгновенно создает алерты
    3. 22:39:55 - Система фиксирует 4 неудачные аутентификации
    4. 22:39:56 - Логируются Failed password попытки
    5. 22:39:57 - Fail2Ban анализирует логи и блокирует IP
    6. 22:39:57+ - Hydra получает ошибки соединения, атака прерывается

4.2. Эффективность атаки Hydra:
    - Результат: ПОЛНЫЙ ПРОВАЛ
    - Причина: Fail2Ban заблокировал IP после первых же попыток
    - Количество проверенных комбинаций: 4 из 950 (0.4%)
    - Вывод: brute-force атака абсолютно неэффективна против защищенного SSH

4.3. Эффективность Suricata:
    - Обнаружение: МГНОВЕННОЕ (алерты в ту же секунду)
    - Типы алертов: корректная классификация SSH сканирования
    - Детализация: IP, порты, тип атаки
    - Но: только обнаружение, без предотвращения

4.4. Эффективность Fail2Ban:
    - Реакция: ИДЕАЛЬНАЯ (2 секунды от первой попытки)
    - Точность: 4 неудачные попытки → блокировка (maxretry=3)
    - Предотвращение: полная остановка атаки
    - Автоматизм: полностью автоматическая работа

5. ВЫВОДЫ

5.1. Ключевые выводы по эксперименту:

    1. **Fail2Ban - исключительно эффективен** против brute-force атак
       - Блокировка через 2 секунды
       - Полное предотвращение атаки
       - Простая настройка, автоматическая работа

    2. **Suricata - отличный детектор**, но не защитник
       - Мгновенное обнаружение
       - Детальная информация
       - Но требует отдельной системы для реагирования

    3. **Hydra бесполезна** против защищенных систем
       - Атака прервана на 0.4% от плана
       - Традиционные brute-force атаки устарели

5.2. Практические рекомендации для администрирования:

    1. **Обязательная настройка Fail2Ban** для всех публичных SSH серверов
    2. **Использование ключей SSH** вместо паролей
    3. **Комбинация Suricata + Fail2Ban** для полной защиты
    4. **Регулярный мониторинг логов** на предмет новых атак
    5. **Обновление правил** для обеих систем


**Наиболее важный результат**: Fail2Ban продемонстрировал 100% эффективность
в защите SSH от brute-force атак, что подтверждает его критическую важность
в современной инфраструктуре безопасности.


```
---

